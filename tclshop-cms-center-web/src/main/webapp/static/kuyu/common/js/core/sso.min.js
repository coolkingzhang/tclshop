/**
 * Created by weinan.zhao on 15-6-5.
 *
 * Base on jQuery version 1.1 above
 * common useage
 * Notice : This apk is based on jQuery lib, so we need include jQuery.js library(version above 1.1)
 * step:
 * 1. Include current file into page. Example: <script type="text/javascript" src="xxx/xx/sso.min.js"></script>
 * 2.On web page user need config parameter for sso object call.
 *     a. jsonpURL: string value, set  user center validate status service url. such as, http://safe.tclclouds.com/account/verifyUsernameToken
 *     b.localValidateUrl: string value, this value is local site validation service url. When current site get the user center 's cookies, then take this cookies and  use this url to further  validate user info and take user info detail.
 *     c:callbacks: Object. Has two keys one is  ssoOK and another is ssoFail. user can user this to do sth on current website
 *  ----------------------------------------------------------------------------------------------------------------------------
 *     on sso validate page we can write like this :
 *      page onload event we regist :function(){
 *         sso.init({jsonpURL:"xxxx",localValidateUrl:"xxxx",callbacks: {ssoOK: ssoOK,ssoFail:ssoFail}});
 *      }
 *
 *      function ssoOK(data){
 *          do something...
 *      }
 *      function ssoFail(data){
 *          do something...
 *      }
 *
 *     ---------------------------------------------------------------------------------------------------------------------------
 *
 */

window.sso=function(t){function a(a){if(a)for(var s in a)i[s]=a[s];var o=t("<script type='text/javascript'></script>"),c=1e3*Math.random()==0?1e3:1e3*Math.random(),l="sscr10iptt_"+c.toFixed()+"_"+(new Date).getTime();o.attr("id",l);var e=i.jsonpURL+"?domId="+l+"&client_id="+i.clientId+"&funcName=sso.writeCookie";o.attr("src",e),t("body").append(o)}function s(t){t&&-1!=t.status?1==t.status&&c(t):o(t)}function o(t){this.callbacks&&this.callbacks.ssoFail&&"function"==typeof this.callbacks.ssoFail&&this.callbacks.ssoFail.call(this,dt),l(t.domId)}function c(a){i&&i.localValidateUrl&&(a.code=encodeURIComponent(a.code),t.ajax({url:i.localValidateUrl,method:"POST",data:a,contextD:a,callbacks:i.callbacks,async:!0,cache:!1,dataType:"json",success:function(t){this.callbacks&&this.callbacks.ssoOK&&"function"==typeof this.callbacks.ssoOK&&this.callbacks.ssoOK.call(this,t),l(this.contextD.domId)},error:function(){l(this.contextD.domId)}}))}function l(a){t("#"+a).remove()}var i={callbacks:{ssoOK:null,ssoFail:null}};return{init:a,evokeLogin:o,writeCookie:s}}(window.jQuery);
